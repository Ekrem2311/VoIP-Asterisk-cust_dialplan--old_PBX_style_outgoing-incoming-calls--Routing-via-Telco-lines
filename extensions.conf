=============================================================================
; EkoF modified Asterisk dialplan for specific scenario @September-2025
;	General settings for Extensions -- Dialplan for routing the VoIP Asterisk calls 

[general]
static=yes
writeprotect=no
autofallthrough=yes
clearglobalvars=no
priorityjumping=no
;=============================================================================
;	Global Variables
[globals]

dahdiTrunk=DAHDI/g0
;this is used if needed for E1 card-30 channels
;=============================================================================
;	Extension contexts below here - from outside calls - incoming through dahdi channels/ telco lines

;when call comes from outside callers to fixed line 0290389008 it will be routed based on cotext configured on chan_dahdi.conf for every line and hit dialplan to call the specified SIP user/EXT
[from-0290389008]
exten => s,1,Dial(SIP/3201,45)
same => n,Hangup()

[from-0290389038]
exten => s,1,Dial(SIP/3202,45)
same => n,Hangup()

[from-0290389039]
exten => s,1,Dial(SIP/3204,45)
same => n,Hangup()

include => inside
include => users

[inside]
exten => 3200,1,Macro(stduser,SIP/3200,60)
same => n,Hangup()
exten => 3201,1,Macro(stduser,SIP/3201,60)
same => n,Hangup()
exten => 3202,1,Macro(stduser,SIP/3202,60)
same => n,Hangup()
exten => 3203,1,Macro(stduser,SIP/3203,60)
same => n,Hangup()
exten => 3204,1,Macro(stduser,SIP/3204,60)
same => n,Hangup()
exten => 3205,1,Macro(stduser,SIP/3205,60)

[users]

include => emergency
include => inside
include => features

;OUTGOING calls from EXTs/SIP users (access level) through different telco lines/dahdi channels 

[fiks_via_0290389008] ; ******* LINE 1 - FIXED CALLS ACCESS **********
; Calls to FIXED OPERATORS/Numbers through Dahdi channel 1/ Telco Line 1 connected on port 1 of Dahdi/digium/sangoma FXO card  -- FIXED CALLS - CHANNEL 1

exten => _038XXXX.,1,Dial(DAHDI/1/${EXTEN},60) 
same => n,Hangup()
exten => _028XXXX.,1,Dial(DAHDI/1/${EXTEN},60)
same => n,Hangup()
exten => _029XXXX.,1,Dial(DAHDI/1/${EXTEN},60)
same => n,Hangup()
include => users

[mobil_via_0290389008] ; ******* LINE 1 - MOBILE CALLS ACCESS **********
; Calls to MOBILE OPERATORS/Numbers through Dahdi channel 1/ Telco Line 1 connected on port 1 of Dahdi/digium/sangoma FXO card -- MOBILE CALLS - CHANNEL 1

exten => _044XXXX.,1,Dial(DAHDI/1/${EXTEN},60)
same => n,Hangup()
exten => _045XXXX.,1,Dial(DAHDI/1/${EXTEN},60)
same => n,Hangup()
exten => _048XXXX.,1,Dial(DAHDI/1/${EXTEN},60)
same => n,Hangup()
include => fiks_via_0290389008

[fiks_via_0290389038]  ; ******* LINE 2 - FIXED CALLS ACCESS **********
; Calls to FIXED OPERATORS/Numbers through Dahdi channel 2/Telco Line 2 connected on port 2 of Dahdi/digium/sangoma FXO card  -- FIXED CALLS - CHANNEL 2

exten => _038XXXX.,1,Dial(DAHDI/2/${EXTEN},60) 
same => n,Hangup()
exten => _028XXXX.,1,Dial(DAHDI/2/${EXTEN},60)
same => n,Hangup()
exten => _029XXXX.,1,Dial(DAHDI/2/${EXTEN},60)
same => n,Hangup()
include => users

[mobil_via_0290389038]  ; ******* LINE 2 - MOBILE CALLS ACCESS **********
; Calls to MOBILE OPERATORS/Numbers through Dahdi channel 2/Telco Line 2 connected on port 2 of Dahdi/digium/sangoma FXO card -- MOBILE CALLS - CHANNEL 2

exten => _044XXXX.,1,Dial(DAHDI/2/${EXTEN},60)
same => n,Hangup()
exten => _045XXXX.,1,Dial(DAHDI/2/${EXTEN},60)
same => n,Hangup()
exten => _048XXXX.,1,Dial(DAHDI/2/${EXTEN},60)
same => n,Hangup()
include => fiks_via_0290389038

[fiks_via_0290389039]  ; ******* LINE 3 - FIXED CALLS ACCESS **********
; Calls to FIXED OPERATORS/Numbers through Dahdi channel 3/Telco Line 3 connected on port 3 of Dahdi/digium/sangoma FXO card  -- FIXED CALLS - CHANNEL 3

exten => _038XXXX.,1,Dial(DAHDI/3/${EXTEN},60) 
same => n,Hangup()
exten => _028XXXX.,1,Dial(DAHDI/3/${EXTEN},60)
same => n,Hangup()
exten => _029XXXX.,1,Dial(DAHDI/3/${EXTEN},60)
same => n,Hangup()
include => users

[mobil_via_0290389039]  ; ******* LINE 3 - MOBILE CALLS ACCESS **********
; Calls to MOBILE OPERATORS/Numbers through Dahdi channel 3/Telco Line 3 connected on port 3 of Dahdi/digium/sangoma FXO card -- MOBILE CALLS - CHANNEL 3

exten => _044XXXX.,1,Dial(DAHDI/3/${EXTEN},60)
same => n,Hangup()
exten => _045XXXX.,1,Dial(DAHDI/3/${EXTEN},60)
same => n,Hangup()
exten => _048XXXX.,1,Dial(DAHDI/3/${EXTEN},60)
same => n,Hangup()
include => fiks_via_0290389039

;the same logic continues if needed for other numbers like 0290389040, 041 ... etc
;=============================================================================
; .....................
; .....................more dialplan
; .....................more contexts 
; .....................not needed here for this example/scenario
; .....................
; .....................

[macro-stduser]

exten => s,1,NoOp(${CALLERID(all)} is calling ${MACRO_EXTEN} on ${ARG1} with ${ARG2} seconds ringing duration - time -- by EkoF@2025 .)
same => n,Dial(${ARG1},${ARG2})
same => n,GotoIf($["${DIALSTATUS}" = "NOANSWER"]?noanswer)
same => n,GotoIf($["${DIALSTATUS}" = "CHANUNAVAIL"]?unavailable)
same => n,GotoIf($["${DIALSTATUS}" = "CONGESTION"]?unavailable)
same => n,GotoIf($["${DIALSTATUS}" = "CANCEL"]?hangup)
same => n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy)
same => n,Goto(congest)

[macro-stdtrunk]

exten => s,1,NoOp(${CALLERID(all)} is calling ${MACRO_EXTEN} on  ${ARG1} with ${ARG2} seconds ringing duration.)
same => n,Set(dirName=${STRFTIME(${EPOCH},,%Y/%m/%d)})
same => n,Set(chanName=${STRREPLACE(CHANNEL,/,-)})
same => n,Set(dateTime=${STRFTIME(${EPOCH},,%d%m%Y-%H%M%S)})
same => n,Set(fileName=${chanName} - ${dateTime})
same => n,Set(fileType=wav)
same => n,Set(MixMonitorParam=${dirName}/${fileName}.${fileType})
same => n,MixMonitor(${MixMonitorParam},b)
same => n,Queue(test)
;same => n,Dial(${ARG1},${ARG2})
same => n,Hangup()

